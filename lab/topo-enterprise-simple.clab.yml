name: bgp-enterprise-simple

topology:
  nodes:
    # Core Layer - 2 Core Routers
    core-01:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/core-01/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/core-01:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "core"
        asn: "65000"

    core-02:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/core-02/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/core-02:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "core"
        asn: "65000"

    # Distribution Layer - 4 Distribution Switches
    dist-01:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/dist-01/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/dist-01:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "distribution"
        asn: "65100"

    dist-02:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/dist-02/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/dist-02:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "distribution"
        asn: "65100"

    dist-03:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/dist-03/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/dist-03:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "distribution"
        asn: "65100"

    dist-04:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/dist-04/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/dist-04:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "distribution"
        asn: "65100"

    # Access Layer - 10 Access Switches
    access-01:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-01/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-01:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    access-02:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-02/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-02:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    access-03:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-03/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-03:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    access-04:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-04/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-04:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    access-05:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-05/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-05:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    access-06:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-06/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-06:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    access-07:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-07/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-07:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    access-08:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-08/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-08:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    access-09:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-09/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-09:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    access-10:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/access-10/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/access-10:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "access"
        asn: "65200"

    # Edge Routers - 2 Edge Devices
    edge-01:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/edge-01/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/edge-01:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "edge"
        asn: "65300"

    edge-02:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/edge-02/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/edge-02:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "edge"
        asn: "65300"

    # Servers - 10 Server Nodes
    server-01:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-01/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-01:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    server-02:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-02/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-02:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    server-03:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-03/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-03:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    server-04:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-04/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-04:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    server-05:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-05/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-05:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    server-06:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-06/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-06:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    server-07:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-07/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-07:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    server-08:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-08/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-08:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    server-09:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-09/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-09:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    server-10:
      kind: linux
      image: frrouting/frr:latest
      cmd: /usr/lib/frr/docker-start
      binds:
        - ./configs/enterprise/server-10/frr.conf:/etc/frr/frr.conf:ro
        - ./configs/common/daemons:/etc/frr/daemons:ro
        - ./configs/common/vtysh.conf:/etc/frr/vtysh.conf:ro
        - ./configs/common/zebra.conf:/etc/frr/zebra.conf:ro
        - ./logs/server-10:/var/log/frr:rw
      env:
        FRR_DAEMONS: "zebra,bgpd"
      labels:
        role: "server"
        asn: "65400"

    # Monitoring and Collection
    data-collector:
      kind: linux
      image: alpine:latest
      cmd: /bin/sh -c "while true; do echo 'BGP data simulation'; sleep 1; done"
      labels:
        role: "collector"

    fluent-bit:
      kind: linux
      image: fluent/fluent-bit:latest
      cmd: /fluent-bit/bin/fluent-bit
      binds:
        - ./monitoring/fluent-bit.conf:/fluent-bit/etc/fluent-bit.conf:ro
        - ./logs:/var/log:ro
      labels:
        role: "monitoring"


  links:
    # Core to Core
    - endpoints: ["core-01:eth1", "core-02:eth1"]
    
    # Core to Distribution
    - endpoints: ["core-01:eth2", "dist-01:eth1"]
    - endpoints: ["core-01:eth3", "dist-02:eth1"]
    - endpoints: ["core-02:eth2", "dist-03:eth1"]
    - endpoints: ["core-02:eth3", "dist-04:eth1"]

    # Distribution to Access
    - endpoints: ["dist-01:eth2", "access-01:eth1"]
    - endpoints: ["dist-01:eth3", "access-02:eth1"]
    - endpoints: ["dist-02:eth2", "access-03:eth1"]
    - endpoints: ["dist-02:eth3", "access-04:eth1"]
    - endpoints: ["dist-03:eth2", "access-05:eth1"]
    - endpoints: ["dist-03:eth3", "access-06:eth1"]
    - endpoints: ["dist-04:eth2", "access-07:eth1"]
    - endpoints: ["dist-04:eth3", "access-08:eth1"]
    - endpoints: ["dist-01:eth4", "access-09:eth1"]
    - endpoints: ["dist-02:eth4", "access-10:eth1"]

    # Access to Servers
    - endpoints: ["access-01:eth2", "server-01:eth1"]
    - endpoints: ["access-02:eth2", "server-02:eth1"]
    - endpoints: ["access-03:eth2", "server-03:eth1"]
    - endpoints: ["access-04:eth2", "server-04:eth1"]
    - endpoints: ["access-05:eth2", "server-05:eth1"]
    - endpoints: ["access-06:eth2", "server-06:eth1"]
    - endpoints: ["access-07:eth2", "server-07:eth1"]
    - endpoints: ["access-08:eth2", "server-08:eth1"]
    - endpoints: ["access-09:eth2", "server-09:eth1"]
    - endpoints: ["access-10:eth2", "server-10:eth1"]

    # Edge connectivity
    - endpoints: ["core-01:eth4", "edge-01:eth1"]
    - endpoints: ["core-02:eth4", "edge-02:eth1"]

    # Monitoring connections
    - endpoints: ["core-01:eth5", "data-collector:eth1"]
